# Ignored by docker compose, used by devservices
x-sentry-service-config:
  version: 0.1
  service_name: objectstore
  dependencies:
    objectstore:
      description: Objectstore server
    bigtable:
      description: Google Cloud BigTable emulator
    gcs:
      description: Google Cloud Storage emulator
  modes:
    default: []
    containerized: [objectstore]
    full: [bigtable, gcs]

x-programs:
  devserver:
    command: cargo run --

services:
  objectstore:
    image: ghcr.io/getsentry/objectstore:nightly
    environment:
      FSS_HIGH_VOLUME_STORAGE__TYPE: "filesystem"
      FSS_HIGH_VOLUME_STORAGE__PATH: "/data"
      FSS_LONG_TERM_STORAGE__TYPE: "filesystem"
      FSS_LONG_TERM_STORAGE__PATH: "/data"
      FSS_LOGGING__LEVEL: "debug"
    ports:
      - 127.0.0.1:8888:8888
    volumes:
      - objectstore-data:/data
    networks:
      - devservices
    labels:
      - orchestrator=devservices
    restart: unless-stopped
  bigtable:
    image: google/cloud-sdk
    command:
      - "gcloud"
      - "beta"
      - "emulators"
      - "bigtable"
      - "start"
      - "--host-port=0.0.0.0:8086"
    ports:
      - 127.0.0.1:8086:8086
    networks:
      - devservices
    labels:
      - orchestrator=devservices
    restart: unless-stopped
  gcs:
    image: gcr.io/cloud-devrel-public-resources/storage-testbench:latest
    environment:
      GOOGLE_CLOUD_CPP_STORAGE_TEST_BUCKET_NAME: test-bucket
    ports:
      - 127.0.0.1:8087:9000
    networks:
      - devservices
    labels:
      - orchestrator=devservices
    restart: unless-stopped

networks:
  devservices:
    name: devservices
    external: true

volumes:
  objectstore-data:
