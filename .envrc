#!/usr/bin/env bash

if [[ -x "${PWD}/.devenv/bin/devenv" ]]; then
    DEVENV="${PWD}/.devenv/bin/devenv"
elif command -v devenv >/dev/null 2>&1; then
    DEVENV="devenv"
fi

# Prever but don't require devenv. We also support a globally installed uv.
if [[ -n "$DEVENV" ]]; then
    $DEVENV sync
    PATH_add "${PWD}/.devenv/bin"
fi

if ! command -v uv >/dev/null 2>&1; then
    echo "ERROR: Please install devenv (https://github.com/getsentry/devenv) or uv (https://docs.astral.sh/uv/)"
    return 1
fi

uv sync --all-groups
source .venv/bin/activate

source_env_if_exists .envrc.private
